==================
Release Notes v2.3
==================

Homer2_UI: 
----------

Added code to allow non-integer downsampling factor in hmrNirsFileDownsample

Added Test folder for simple testing of Homer2_UI functionality. 

Fixed FrameSize in Savitzky Golay smoothing.

Fix for matlab error when starting stimGUI reported by Nadege. Problem was that auxChannels was present in the nirs file but was empty. The length of auxChannels should be equal to the number of columns in aux. Added error check and a repair for auxChannel if it is incorrect format. 

Added hmrMotionCorrectSG.m, performing Savitzky-Golay smoothing

Added hmrMotionCorrectRLOESS, performign RLOESS smoothing

Added hmrMotionCorrectSplineSG which first finds baseline shifts only and then corrects them with spline interpolation and then corrects the spike type motions with Savitzky-Golay smoothing.

Added hmrMotionCorrectPCArecurseCh_SG.m which first finds baseline shifts only and then corrects them with tPCA and then corrects the spike type motions with Savitzky-Golay smoothing.

Added hmrMotionCorrectPCArecurse_Ch_dual.m This function performs tPCA and splice the segments of data together in two different ways (either using one tInc for all channels or using tIncCh), compares the results and picks the good one for a specific channel.

Added hmrtInc_baselineshift_Ch.m which finds the baseline shift type of motions only. This code is for hybrid tPCA-SG and tPCA-Spline codes.


AtlasViewerGUI: 
---------------

Added Test folder for simple testing of AtlasViewer functionality. 


SDgui:
------

Added ability to select optodes by dragging mouse over the desired optodes in the SD geometry axes. Selected optodes and any channels connecting 
them can then be deleted. If exactly one source and one detector are selected, then a channel can be created or deleted between them.

Fixed bug which occassionally prevented the user from selecting any optodes. 


General:
--------

If matlab version is older, prior to R2014a, then let user know that toolboxes cannot be identified and checked.

List of required toolboxes changed in R2015a. Added required toolbox list file for releases after 2014b and code to check the matlab version to find the appropriate toolbox list file. If no file is found then it asks if user wants to generate the new toolbox list file. If not then it displays a message that it is unable to find the approriate toolbox list file.

Revised installation instructions in the REAdME.txt file and corrected wrong information with feedback from Borja Blanco (b.blanco@bcbl.eu), Ryota Nishiyori (ryota.nishiyori@nih.gov). 

Fixed checkToolboxes_AtlasViewer.m and checkToolboxes_Homer2.m to find ALL required toolboxes. Previous list is incomplete. Generated files toolboxesRequired_AtlasViewerGUI.txt and toolboxesRequired_Homer2_UI.txt because it takes a long time to search for toolboxes. 




==================
Release Notes v2.2
==================


Homer2_UI: 
----------

Change HbX line style in data axes display so that HbO, HbR, HbT are constant line styles. HbO is solid. HbR is dashed. HbT is dotted

Changed channel colors of the first few time course data from red, blue and green to orange, green and magenta to avoid confusion with oxy and deoxy HB. 

Fixed bug where time course colors for multiple channels in the data display don't match the channel colors in the SDG axes display. 

Added function and menu option to a) downsample a nirs file and b) create a new nirs file from existing one which only has a specified segment of the original data.

Alert user if there's error when calculating HRF by displaying message box with the error and name of function which failed. 

Fix bug when loading and fixing SD.SpatialUnits, bad channel info in SD.MeasListAct of the 2nd ... Nth .nirs file is overwritten by the first .nirs file's SD.MeasListAct. Katherine Perdue submitted this issue. 

Processing Options GUI window being too long and going beyond screen boundaries in a small screen. 

Fixed issue when starting Homer2_UI and an error is encountered in loaded .nirs files, the error message box display goes off screen on small laptop screens.

Made procStreamGUI.fig resizaeble, and increased font size becasuse really hard to read on smaller screens. 

Fix for db2.mat file not found in Homer2_UI.exe when performaing motion correction with hmrMotionCorrectWavelet.m. This is only a problem in the standalone executable and on Linux. 

Added wavelet motion correction function hmrMotionCorrectKurtosisWavelet.m and supporting function written by Antonio Maria Chiarelli. 

Enabled stimGUI and procStreamGUI resizing. 



AtlasViewerGUI: 
---------------

Updated iso2mesh with the latest code from http://iso2mesh.sourceforge.net/cgi-bin/index.cgi. Iso2mesh is used in AtlasViewer to convert Freesurfer processed MRI files to AtlasViewer format. Previously it only worked on Windows. The update and fixes makes it work on MAC and Linux.

Fix error generating Monte Carlio output when the file path to the input, output or Monte Carlo excutable has spaces in it as can happen on Windows. 

For Matlab versions 2014b, 2015a, and 2015b, display warning when using Find Refpts menu option. This option lets the user pick the Cz, Iz, LPA, RPA, and Cz head reference points from which 10-20 points can be calculated. The warning states that there is a bug in Matlab versaions 2014b, 2015a, and 2015b in the graghics which causes the datacursor to attach to vertices on the the hidden side of the head instead of the selected vertex on the visible side. This issue was fixed in R2016a (9.0). Also this issue doesn''t exist in versions prior to R2014b (8.4), for example R2013b. 

If digitized points files are detected in subject's sub folders (rather then it's own subject folder) then give user a choice to load them or not. This is relevant to group imaging with several subjects all with the same probe digitized.

When overlaying HbConc group average, import probe that is the mean of digitized points of the group subjects instead of design probe. 

Increased the size of the ref point markers on the head in Find Ref Points.

Fix loading of fluence files errors after saving atlas viewer state of registered probe then restarting atlasviewer and reloading fluence files got error that voxPerVoxel field nonexistent. 

Fixed iso2mesh used to resample meshes in Freesurfer-to-Viewer conversions

Fixed saveRefpts not saving correctly when using Find Ref Pts feature and changed functionality to allow overwriting atlas ref pts and displaying a warning. By contrast overwriting ref pts in local subject dir doesn't produce warning, only a message informing user that old refpts will be moved to refpts*.old. The bug was due to an incorrect path in refpts telling you where the ref pts came from.

Fix bug in probe placement variation to account for the fact that short separation detectors are thrown away. 

Added ability to AtlasViewerGUI to overlay image of Hb Concentration on the cortex, using the .nirs files HRF data produced by Homer2.

Changed menu options in AtlasViewerGUI, related to probe projection by consolidating channels and optodes projection to one menu option, 'Project Probe to Cortex'. The user then chooses if they want to project optodes or channels. 

Add lower resolution one wavelength fluenceProf files to homer2. 

Fix in AtlasViewerGUI to Freesurfer-to-Viewer conversion. 

Display waitbar when saving viewer state because it takes about 10-20 seconds, to let the user know what's going on.

Added code to AtlasViewerGUI to display the saved state of the Hb Image Reconstruction. It was being saved but not displayed when the GUI starts up.

Added checkbox to probe placement displays to toggle between AtlasViewer and MNI coordinates. 

Changed the color of the head and pial surfaces to be more pleasing to the eye.

Reduced the shininess of the light on surfaces. 

Changed the lighting to be spread evenly over the surfaces. 

Fixed left-right side flipping problem in probe placement variation feature in AtlasViewerGUI. 

Fix bug in orientation when converting Freesurfer files to AtlasViewer.

Fix for matlab error when loading nirs files without tHRF. 

Added user configuration of max/min tHRF range in HB Concentration overlay calculation.

Fix matlab error in AtlasViewerGUI, when dummy optodes don't exist.

Fix error in AtlasViewerGUI, Hb Image reconstruction, where HbO is always displayed when changing channels, even when HbR is selected. 

Added ability to select channel in Hb Concentration display. 

Changed color of cortex in Image Display objects. 

Greatly simplified image display panel in AtlasViewerGUI where sensititivity and image reconstruction are displayed. 

When importing probe, If probe is misaligned warn user about it and ask if they still want to try to project (register) probe to head.


SDgui: 
------

Fix problem of inability to select optodes with the mouse in some instances like with a dense probe.

Fix bug where user starts SDgui, cancels .SD file search in order to create new probe geometry, then enters coordinates of first optode which generates matlab error. 

When saving file in SDgui, made .SD extension the default extension when user doesn't provide an extension. 


Miscellanious:
--------------
This release's homer2_install*.zip installation package was built with Matlab R2016a (instead of R2014b used in previous release). Users of the stand alone executables have to download and install Matlab Compiler Runtime 2016a. 

Created function checkToolboxes.m, and checkToolboxes_Homer2.m and checkToolboxes_AtlasViewer.m to check if the required toolboxes for these tools are installed and if not to warn the user about it, listing which toolboxes are missing. Added this check to setpaths and also added list of required toolboxes to README.txt. 

Update setpath to check matlab compatibility if required toolboxes exist.

Added setpaths.m for setting the Homer2 and AtlasViewer search paths in matlab, every time a new matlab session is started. 

Added ability to remove the homer2 paths using the command setpath(0). 

Created homer_install installation packages for Windows, MAC and Linux for installing and running Homer2 and AtlasViewer standalone executables. 



==================
Release Notes v2.1
==================

-- Made invisible the menu options to generate and load fluence profiles and to do image recon. 

-- Modified Buildme script to build AtlasViewerGUI so that it builds successfully and loads very quickly the first and subsequent times. This might be a good solution for the incredible amount of time it took to build and 
load AtlasViewerGUI in the NIRS class in 2013b. (At least in my testing it worked this way. Needs to be tested by others on other platfoms to confirm). 

-- I built Homer2_UI.exe and AtlasViewerGUI.exe in 2014b but haven't released it yet. For the release I'm proposing the version 2.1.  

-- Added AtlasViewerGUI version to saveObjects.m so that we know what version of the GUI was used to save the viewer state. 

-- Fixed faulty error checking code in getProbe which loads and compares measurement list from SD file to digpts sources and detectors. Also rather than reject the whole SD.MeasList if the measlist references undigitized optodes, only throw away invalid channels and keep the rest of the measlist.

-- There was an old problem where white dots appearing against head in AtlasViewer. The reason was that the display function plotted these points to indicate the bounding box of the display objects so the axes would resize automatically to include text graphics. In matlab text graphics are annotations which do not resize the axes making graphics like numbered optodes or digitizede points be totally or partially obscured by a undersized axes, especially if you rotate the axes with the digitized points. But I got rid of the white dots due to complaints about them in homer-users list by commenting out the code in viewPts which draws those dots, forgetting about the problem it was meant to solve. This change in viewPts fixes both the white dots problem and the digitized points being obscured problem by just changing the 'marker' property from '.' to 'none'.

-- Meryem found bug. When saving viewer state of subjects separately and then adding those subjects to group the subject id remains = 1 even though it should have changed to it's new group subject id. It gets the wrong subject id from the saved viewer state. The solution is not to save some fields such as subj id. To fix added function ptr to each object, prepObjForSave, where each object defines it's own field that should be removed before saving object. 

-- Finally found the correct way to determine orientation and display head objects so that left-right show up correctly based on the reference points and Freesurfer style 3 letter code from AP/SI/LR (Anterior-Posterior/Superior-Inferior/Left-Right). Cleaned out the code from incorrect old method using T_2ras. 

-- Added backward compatibility with saved state objects from precious versions. This involved adding the function pointer to each object, checkCompatability(). 

-- Made rotate axes buttons work the same as the way David did in brainscape - simple characters <, >, /\, and \/ rather than fancy special chracters created by the uibutton function which was removed. 
